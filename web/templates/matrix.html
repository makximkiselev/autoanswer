<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>üìä –ü—Ä–∞–π—Å-–º–∞—Ç—Ä–∏—Ü–∞</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        h2, h3 { margin-top: 1em; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 2em; }
        th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
        th { background-color: #f5f5f5; }
    </style>
</head>
<body>
    <h1>üìä –ü—Ä–∞–π—Å-–º–∞—Ç—Ä–∏—Ü–∞</h1>
    <button onclick="cleanProducts()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–∏–≤—è–∑–∫–∏</button>

    {% for category, brands in tree.items() %}
        <h2>{{ category }}</h2>
        {% for brand, models in brands.items() %}
            <h3>{{ brand }}</h3>
            {% for model, products in models.items() %}
                <h4>{{ model }}</h4>
                <table>
                    <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>name_std</th>
                            <th>–ú–∏–Ω. —Ü–µ–Ω–∞</th>
                            <th>–¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º</th>
                            <th>–ö–æ–ª-–≤–æ —Ü–µ–Ω</th>
                            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in products %}
                        <tr>
                            <td>{{ p.product }}</td>
                            <td>{{ p.name_std }}</td>
                            <td>{{ p.min_price or "-" }}</td>
                            <td>{{ p.prices or "-" }}</td>
                            <td>{{ p.price_count }}</td>
                            <td>
                                <form method="post" action="/matrix/unlink" style="display:inline;">
                                    <input type="hidden" name="cleaned_id" value="{{ p.cleaned_id }}">
                                    <button type="submit" onclick="return confirm('–£–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É?')">‚ùå</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% endfor %}
        {% endfor %}
    {% endfor %}

    <nav>
        <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/unknowns" style="margin-left: 1em;">üß† –ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ</a>
    </nav>

<script>
async function cleanProducts() {
    try {
        const res = await fetch("/admin/clean-products");
        const data = await res.json();
        if (data.ok) {
            alert("üßπ –£–¥–∞–ª–µ–Ω–æ –ø—Ä–∏–≤—è–∑–æ–∫: " + data.deleted);
            location.reload();
        } else {
            alert("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ.");
        }
    } catch (e) {
        alert("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞");
    }
}
</script>

</body>
</html>
