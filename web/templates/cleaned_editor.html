<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –º–æ–¥–µ–ª–µ–π</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
        }
        th {
            background-color: #f0f0f0;
        }
        input[type="text"] {
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h2>üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π</h2>

    <form method="get" action="/cleaner">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –º–æ–¥–µ–ª–∏..." value="{{ request.query_params.get('q', '') }}">
        <button type="submit">üîç –ù–∞–π—Ç–∏</button>
        <a href="/cleaner">üîÑ –°–±—Ä–æ—Å</a>
    </form>

    <br>
    <form action="/cleaner/bulk-update" method="post">
        <table>
            <thead>
                <tr>
                    <th></th>
                    <th>ID</th>
                    <th>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–≠—Ç–∞–ª–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å</th>
                    <th>–û–±–Ω–æ–≤–∏—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                {% for id, name, std in items %}
                <tr>
                    <td><input type="checkbox" name="selected_ids" value="{{ id }}"></td>
                    <td>{{ id }}</td>
                    <td>{{ name }}</td>
                    <td>
                        <form action="/cleaner/update" method="post">
                            <input type="hidden" name="product_id" value="{{ id }}">
                            <input type="text" name="new_standard" value="{{ std }}" list="stdlist">
                    </td>
                    <td>
                            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <br>
        <h4>–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏</h4>
        <input type="text" name="new_standard_bulk" placeholder="–ù–æ–≤–∞—è —ç—Ç–∞–ª–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å" list="stdlist" required>
        <button type="submit">üîó –û–±—ä–µ–¥–∏–Ω–∏—Ç—å</button>
    </form>

    <nav style="margin-bottom: 1em;">
        <a href="/" style="margin-right: 1em;">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/matrix" style="margin-right: 1em;">üìä –ü—Ä–∞–π—Å-–º–∞—Ç—Ä–∏—Ü–∞</a>
        <a href="/cleaner" style="margin-right: 1em;">üßπ –û—á–∏—Å—Ç–∫–∞ –º–æ–¥–µ–ª–µ–π</a>
        <a href="/unknowns">üß† –ù–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ</a>
    </nav>

    <datalist id="stdlist">
        {% set unique_std = items | map(attribute=2) | unique | list %}
        {% for std in unique_std %}
            <option value="{{ std }}">
        {% endfor %}
    </datalist>

    <script>
        document.querySelectorAll('form[action="/cleaner/update"]').forEach(form => {
            form.addEventListener('submit', () => {
                const text = form.querySelector('input[name="new_standard"]').value.toLowerCase();
                const lineup = ['iphone', 'ipad', 'watch', 'macbook', 'galaxy', 'note', 'pixel'].find(k => text.includes(k));
                const regionMatch = text.match(/\b(ch|us|eu|hk|ae|my|jp|kr)\b/);
                console.log('üß© –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç:', { lineup, region: regionMatch ? regionMatch[0] : null });
            });
        });
    </script>

    <br>
    <a href="/">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
</body>
</html>
